<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Management - –ö–∞–Ω–±–∞–Ω (–†–∞–±–æ—á–∞—è –≤–µ—Ä—Å–∏—è)</title>
    <style>
        /* ------------------------------------- */
        /* 1. –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –∏ –¶–≤–µ—Ç–æ–≤–∞—è –°—Ö–µ–º–∞ (Dark Theme) */
        /* ------------------------------------- */
        :root {
            --bg-color-dark: #1E1A33; /* –ì–ª–∞–≤–Ω—ã–π —Ç–µ–º–Ω—ã–π —Ñ–æ–Ω */
            --bg-card: #2B2544; /* –§–æ–Ω –∫–∞—Ä—Ç–æ—á–µ–∫ –∏ –∫–æ–ª–æ–Ω–æ–∫ */
            --text-light: #E0E0FF; /* –°–≤–µ—Ç–ª—ã–π —Ç–µ–∫—Å—Ç */
            --text-subtle: #8A859E; /* –°–µ—Ä—ã–π —Ç–µ–∫—Å—Ç/–∏–∫–æ–Ω–∫–∏ */
            --accent-blue: #555CE8; /* –û—Å–Ω–æ–≤–Ω–æ–π –∞–∫—Ü–µ–Ω—Ç–Ω—ã–π —Å–∏–Ω–∏–π */
            --color-draft: #9b59b6; /* –§–∏–æ–ª–µ—Ç–æ–≤—ã–π (Draft) */
            --color-progress: #f1c40f; /* –ñ–µ–ª—Ç—ã–π (In Progress) */
            --color-editing: #e67e22; /* –û—Ä–∞–Ω–∂–µ–≤—ã–π (Editing) */
            --color-done: #2ecc71; /* –ó–µ–ª–µ–Ω—ã–π (Done) */
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color-dark);
            color: var(--text-light);
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* ------------------------------------- */
        /* 2. –ù–∞–≤–∏–≥–∞—Ü–∏—è –∏ –®–∞–ø–∫–∞ (–ò–º–∏—Ç–∞—Ü–∏—è) */
        /* ------------------------------------- */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 30px;
            background-color: var(--bg-card);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .header-title { font-size: 24px; font-weight: 600; color: var(--text-light); }
        .header-menu a {
            color: var(--text-subtle);
            margin-left: 20px;
            text-decoration: none;
            transition: color 0.2s;
        }
        .header-menu a:hover { color: var(--text-light); }
        
        /* ------------------------------------- */
        /* 3. –û—Å–Ω–æ–≤–Ω–∞—è –ö–∞–Ω–±–∞–Ω-–û–±–ª–∞—Å—Ç—å */
        /* ------------------------------------- */
        .kanban-board-container {
            display: flex;
            padding: 20px;
            gap: 20px; 
            flex-wrap: nowrap; /* –í–∞–∂–Ω–æ: —á—Ç–æ–±—ã –∫–æ–ª–æ–Ω–∫–∏ –Ω–µ –ø–µ—Ä–µ–Ω–æ—Å–∏–ª–∏—Å—å */
            overflow-x: auto; /* –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞—Ç—å –¥–æ—Å–∫—É –ø—Ä–∏ —É–∑–∫–æ–º —ç–∫—Ä–∞–Ω–µ */
        }
        .kanban-column {
            flex: 0 0 280px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –∫–æ–ª–æ–Ω–∫–∏ */
            min-width: 280px;
            max-width: 280px;
            padding: 10px;
            background-color: #24203A; /* –ë–æ–ª–µ–µ —Ç–µ–º–Ω—ã–π —Ñ–æ–Ω –¥–ª—è –æ–±–ª–∞—Å—Ç–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ */
            border-radius: 8px;
        }
        .column-header {
            font-size: 16px;
            font-weight: bold;
            text-transform: uppercase;
            padding-bottom: 10px;
            margin-bottom: 15px;
            color: var(--text-light);
            border-bottom: 2px solid var(--text-subtle);
        }
        .column-draft .column-header { border-color: var(--color-draft); }
        .column-progress .column-header { border-color: var(--color-progress); }
        .column-editing .column-header { border-color: var(--color-editing); }
        .column-done .column-header { border-color: var(--color-done); }

        /* 4. –ö–∞—Ä—Ç–æ—á–∫–∞ –ó–∞–¥–∞—á–∏ */
        .task-card {
            background-color: var(--bg-card);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            border-left: 5px solid var(--accent-blue); 
            transition: transform 0.2s;
        }
        .task-card:hover { transform: translateY(-3px); }

        .task-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
        }
        .task-meta {
            font-size: 12px;
            color: var(--text-subtle);
            margin-top: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .task-icons span { margin-right: 10px; }
        
        /* –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è (–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Å—Ç–∏–ª—å) */
        .delete-btn {
            background: #e74c3c; /* –ö—Ä–∞—Å–Ω—ã–π —Ñ–æ–Ω */
            color: white;
            border: none;
            cursor: pointer;
            font-size: 12px;
            padding: 5px 8px;
            border-radius: 4px;
            opacity: 0.8;
            transition: opacity 0.2s, background-color 0.2s;
        }
        .delete-btn:hover { 
            opacity: 1; 
            background-color: #c0392b; 
        }

        /* –°—Ç–∏–ª–∏ —Ñ–æ—Ä–º—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è */
        #add-task-form-container {
            background-color: var(--bg-card);
            padding: 15px;
            border-radius: 8px;
            margin: 20px;
        }
        #add-task-form input, #add-task-form select {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            background-color: #3B3454;
            border: 1px solid #50486D;
            color: var(--text-light);
            border-radius: 4px;
            box-sizing: border-box;
        }
        #add-task-form button {
            width: 100%;
            padding: 12px;
            background-color: var(--accent-blue);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        #add-task-form button:hover { background-color: #444AEB; }

        /* –°–∞–π–¥–±–∞—Ä */
        .main-content {
            display: flex;
            flex-direction: row; /* –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å–∫–∏ –∏ —Å–∞–π–¥–±–∞—Ä–∞ */
            padding: 0 20px 20px 20px;
        }
        .sidebar {
            width: 300px;
            min-width: 300px;
            padding: 20px;
            background-color: var(--bg-card);
            border-radius: 8px;
            margin-left: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .kanban-area {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
    </style>
</head>
<body>
    
    <div class="header">
        <div class="header-title">‚ò∞ Task Management</div>
        <div class="header-menu">
            <a href="#">Pricing</a>
            <a href="#">About</a>
            <a href="#">Language</a>
            <a href="#">Conditions</a>
        </div>
    </div>

    <div class="main-content">
        
        <div class="kanban-area">
            <div class="kanban-board-container">
                <div id="draft-column" class="kanban-column column-draft" data-status="DRAFT">
                    <div class="column-header">Draft</div>
                </div>

                <div id="progress-column" class="kanban-column column-progress" data-status="IN_PROGRESS">
                    <div class="column-header">In Progress</div>
                </div>

                <div id="editing-column" class="kanban-column column-editing" data-status="EDITING">
                    <div class="column-header">Editing</div>
                </div>
                
                <div id="done-column" class="kanban-column column-done" data-status="DONE">
                    <div class="column-header">Done</div>
                </div>
            </div>
            
            <div id="add-task-form-container">
                <h2>‚ûï –î–æ–±–∞–≤–∏—Ç—å –ù–æ–≤—É—é –ó–∞–¥–∞—á—É</h2>
                <form id="add-task-form">
                    <input type="text" id="task-title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏" required>
                    <input type="text" id="task-description" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ" required>
                    <select id="task-status" required>
                        <option value="DRAFT" selected>Draft</option>
                        <option value="IN_PROGRESS">In Progress</option>
                        <option value="EDITING">Editing</option>
                        <option value="DONE">Done</option>
                    </select>
                    <button type="submit">–î–æ–±–∞–≤–∏—Ç—å –ó–∞–¥–∞—á—É</button>
                </form>
            </div>
        </div>

        <div class="sidebar">
            <div class="sidebar-header">
                <h2>Name Surname</h2>
                <span style="color: var(--accent-blue);">Task Author</span>
            </div>
            
            <div class="sidebar-metric">
                <h3>Completed Tasks (Mock)</h3>
                <div style="display: flex; gap: 5px; height: 30px;">
                    <div style="flex: 2; background-color: #555CE8; border-radius: 4px;"></div>
                    <div style="flex: 1; background-color: #9b59b6; border-radius: 4px;"></div>
                    <div style="flex: 1.5; background-color: #f1c40f; border-radius: 4px;"></div>
                    <div style="flex: 0.8; background-color: #e67e22; border-radius: 4px;"></div>
                </div>
            </div>

            <div class="sidebar-metric">
                <h3>Efficiency (Mock)</h3>
                <div style="display: flex; justify-content: space-around; text-align: center; color: var(--text-light);">
                    <div>75%<br><small style="color: var(--text-subtle);">Author A</small></div>
                    <div>44%<br><small style="color: var(--text-subtle);">Author B</small></div>
                    <div>68%<br><small style="color: var(--text-subtle);">Author C</small></div>
                </div>
            </div>
        </div>
    </div>
    
    <button style="position: fixed; bottom: 20px; left: 20px; padding: 10px; background-color: #2ecc71; color: white; border: none; border-radius: 5px; cursor: pointer;" onclick="window.runUnitTest()">
        –ó–∞–ø—É—Å—Ç–∏—Ç—å Unit-—Ç–µ—Å—Ç
    </button>


    <script type="module" id="data-service">
        // –°–æ–∑–¥–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞/–∏–º–ø–æ—Ä—Ç–∞ –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏
        window.App = window.App || {}; 
        
        const STORAGE_KEY = 'kanbanData';
        let tasks = new Map(); 

        function loadTasks() {
            const data = localStorage.getItem(STORAGE_KEY);
            if (data) {
                const arrayData = JSON.parse(data);
                tasks = new Map(arrayData.map(item => [item.id, item]));
            }
        }

        function saveTasks() {
            const arrayData = Array.from(tasks.values());
            localStorage.setItem(STORAGE_KEY, JSON.stringify(arrayData));
        }

        function addTask(data) {
            const id = Date.now().toString(); 
            const newTask = {
                id: id,
                title: data.title,
                description: data.description,
                status: data.status,
                category: 'Main Task' 
            };
            tasks.set(id, newTask);
            saveTasks();
            return newTask;
        }

        function deleteTask(id) {
            const wasDeleted = tasks.delete(id);
            if (wasDeleted) {
                saveTasks();
            }
            return wasDeleted;
        }

        function getTasksByStatus(status) {
            return Array.from(tasks.values()).filter(task => task.status === status);
        }
        
        // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –≥–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç App
        window.App.Data = { addTask, deleteTask, getTasksByStatus };
        loadTasks(); // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    </script>

    <script type="module" id="ui-service">
        window.App = window.App || {}; 

        const COLUMNS = {
            'DRAFT': document.getElementById('draft-column'),
            'IN_PROGRESS': document.getElementById('progress-column'),
            'EDITING': document.getElementById('editing-column'),
            'DONE': document.getElementById('done-column')
        };
        const form = document.getElementById('add-task-form');

        function getFormData() {
            return {
                title: document.getElementById('task-title').value.trim(),
                description: document.getElementById('task-description').value.trim(),
                status: document.getElementById('task-status').value
            };
        }

        function clearForm() {
            form.reset();
            document.getElementById('task-status').value = "DRAFT"; // –°–±—Ä–æ—Å —Å—Ç–∞—Ç—É—Å–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        }

        function createCardElement(task, onDelete) {
            const card = document.createElement('div');
            card.className = 'task-card';
            card.dataset.id = task.id;
            
            let borderColor = 'var(--accent-blue)'; // Default
            if (task.status === 'DRAFT') borderColor = 'var(--color-draft)';
            else if (task.status === 'IN_PROGRESS') borderColor = 'var(--color-progress)';
            else if (task.status === 'EDITING') borderColor = 'var(--color-editing)';
            else if (task.status === 'DONE') borderColor = 'var(--color-done)';
            
            card.style.borderLeftColor = borderColor;

            card.innerHTML = `
                <div class="task-title">${task.title}</div>
                <div style="font-size: 13px; color: var(--text-light); opacity: 0.8; margin-bottom: 8px;">${task.description}</div>
                <div class="task-meta">
                    <div class="task-icons">
                        <span title="Comments">üí¨</span>
                        <span title="Priority">‚≠ê</span>
                    </div>
                    <button class="delete-btn" data-id="${task.id}">üóë –£–¥–∞–ª–∏—Ç—å</button>
                </div>
            `;

            const deleteButton = card.querySelector('.delete-btn');
            deleteButton.addEventListener('click', () => onDelete(task.id));
            return card;
        }

        function renderBoard(tasksByStatus, onDelete) {
            // –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –∫–æ–ª–æ–Ω–æ–∫
            Object.values(COLUMNS).forEach(col => {
                const header = col.querySelector('.column-header');
                // –£–¥–∞–ª—è–µ–º –≤—Å–µ, –∫—Ä–æ–º–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞
                while (col.lastChild !== header) { 
                    col.removeChild(col.lastChild);
                }
            });

            // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∑–∞–¥–∞—á
            for (const status in tasksByStatus) {
                const tasks = tasksByStatus[status];
                const column = COLUMNS[status];
                
                tasks.forEach(task => {
                    const cardElement = createCardElement(task, onDelete);
                    column.appendChild(cardElement);
                });
            }
        }

        function onFormSubmit(handler) {
            form.addEventListener('submit', (event) => {
                event.preventDefault();
                handler();
            });
        }
        
        window.App.UI = { getFormData, clearForm, renderBoard, onFormSubmit };
    </script>
    
    <script type="module" id="main-controller">
        // –ò–º–ø–æ—Ä—Ç —á–µ—Ä–µ–∑ –≥–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç App
        const Data = window.App.Data;
        const UI = window.App.UI;

        function refreshBoard() {
            // [Breakpoint 1: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å–∫–∏]
            const tasksByStatus = {
                'DRAFT': Data.getTasksByStatus('DRAFT'),
                'IN_PROGRESS': Data.getTasksByStatus('IN_PROGRESS'),
                'EDITING': Data.getTasksByStatus('EDITING'),
                'DONE': Data.getTasksByStatus('DONE')
            };
            UI.renderBoard(tasksByStatus, handleDelete);
        }

        function handleAdd() {
            const data = UI.getFormData();
            
            if (!data.title || !data.description || !data.status) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
                return;
            }

            // [Breakpoint 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏]
            Data.addTask(data);
            UI.clearForm();
            refreshBoard();
        }

        function handleDelete(id) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–¥–∞—á—É?')) {
                Data.deleteTask(id);
                refreshBoard();
            }
        }

        function init() {
            UI.onFormSubmit(handleAdd);
            refreshBoard();
            console.log("–ö–∞–Ω–±–∞–Ω-–¥–æ—Å–∫–∞ 'Task Management' –∑–∞–ø—É—â–µ–Ω–∞.");
        }

        init();
    </script>
    
    <script>
        // –ö–æ–¥ Unit-—Ç–µ—Å—Ç–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, –Ω–æ –≤—ã–∑–≤–∞–Ω —á–µ—Ä–µ–∑ window.runUnitTest()
        function runUnitTest() {
            console.log('--- –ó–∞–ø—É—Å–∫ Unit-—Ç–µ—Å—Ç–∞ (Data Service) ---');
            
            // –ò–º–∏—Ç–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
            let testMap = new Map();
            const STORAGE_KEY = 'kanbanDataTest';

            function saveTestTasks() {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(Array.from(testMap.values())));
            }

            function addTestTask(data) {
                const id = 'test' + Date.now();
                const newTask = { ...data, id: id, status: data.status };
                testMap.set(id, newTask);
                saveTestTasks();
                return id;
            }

            // --- –¢–µ—Å—Ç 1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ ---
            const initialSize = testMap.size;
            const testData = { title: "Test Task", description: "Unit test description", status: "DRAFT" };
            const addedId = addTestTask(testData);

            console.assert(
                testMap.size === initialSize + 1,
                'Test 1 Failed (Add): –†–∞–∑–º–µ—Ä Map –Ω–µ —É–≤–µ–ª–∏—á–∏–ª—Å—è.'
            );
            console.log(`Test 1 (Add Task): ${testMap.size === initialSize + 1 ? '–£–°–ü–ï–®–ù–û' : '–û–®–ò–ë–ö–ê'}`);

            // --- –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ LocalStorage ---
            const storedData = JSON.parse(localStorage.getItem(STORAGE_KEY));
            console.assert(
                storedData.some(t => t.id === addedId),
                'Test 2 Failed (LocalStorage): –î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ.'
            );
            console.log(`Test 2 (LocalStorage Check): ${storedData.some(t => t.id === addedId) ? '–£–°–ü–ï–®–ù–û' : '–û–®–ò–ë–ö–ê'}`);
            
            console.log('--- Unit-—Ç–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤—ã—à–µ. ---');
            localStorage.removeItem(STORAGE_KEY); 
        }

        window.runUnitTest = runUnitTest; 
    </script>
</body>
</html>
